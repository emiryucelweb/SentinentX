
   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_position_sizing_basic_functionality(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_stop_calculator_basic_functionality(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_bcmath_precision(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_zero_division_protection(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_overflow_protection(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_negative_value_protection(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_risk_calculation_consistency(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\ComprehensiveMathTest::test_leverage_constraints(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\E2E\MultiTenantDataIsolationTest::tenant_a_cannot_access_tenant_b_trades(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\E2E\MultiTenantDataIsolationTest::rls_policies_are_enforced_at_database_level(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\E2E\MultiTenantDataIsolationTest::cross_tenant_update_attempts_fail(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.
PHPUnit 11.5.33 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.6 with Xdebug 3.4.5
Configuration: /home/emir/Desktop/sentinentx/phpunit.xml
Random Seed:   1756302862


   PASS  Tests\Feature\E2E\PerformanceGateSelfBrakeTest
  âœ“ performance above threshold allows trading                           2.63s  
  âœ“ profit factor below threshold triggers self brake                    0.15s  

   WARN  Tests\Feature\Risk\PerformanceGatesTest
  - profit factor below threshold triggers halt â†’ Database schema issues - users table missing for PerformanceGates tests
  - manage only mode is documented â†’ Database schema issues - users table missing for PerformanceGates tests
  - halt expires after duration â†’ Database schema issues - users table missing for PerformanceGates tests
  - insufficient trades allows trading â†’ Database schema issues - users table missing for PerformanceGates tests
  - good performance allows trading â†’ Database schema issues - users table missing for PerformanceGates tests
  - sharpe ratio below threshold triggers halt â†’ Database schema issues - users table missing for PerformanceGates tests
  - halt can be manually lifted â†’ Database schema issues - users table missing for PerformanceGates tests
  - both pf and sharpe below threshold triggers halt â†’ Database schema issues - users table missing for PerformanceGates tests

   PASS  Tests\Feature\FundingGuardTest
  âœ“ allows outside window or low bps                                     0.15s  
  âœ“ blocks inside window with high bps                                   0.11s  

   PASS  Tests\Feature\CiToolsTest
  âœ“ lab log channel exists                                               0.11s  
  âœ“ json log channel exists                                              0.09s  
  âœ“ performance logging                                                  0.11s  
  âœ“ structured logging service                                           0.09s  
  âœ“ ai log channel exists                                                0.11s  
  âœ“ risk logging                                                         0.10s  
  âœ“ business event logging                                               0.10s  
  âœ“ trading log channel exists                                           0.10s  
  âœ“ ai logging                                                           0.10s  
  âœ“ risk log channel exists                                              0.10s  

   PASS  Tests\Feature\CorrelationGuardRiskGateTest
  âœ“ correlation block when above threshold                               0.18s  
  âœ“ correlation allow when no open positions                             0.11s  

   PASS  Tests\Feature\E2E\WebsocketGapBackfillTest
  âœ“ duplicate oco attach prevention during backfill                      0.13s  
  âœ“ websocket gap 30 seconds triggers rest backfill                      0.10s  

   PASS  Tests\Feature\TradeCloserTest
  âœ“ close market reduce only                                             0.12s  

   PASS  Tests\Feature\OpenNowCommandTest
  âœ“ command handles symbols with spaces                                  2.06s  
  âœ“ command with missing required fields                                 1.96s  
  âœ“ command with invalid snapshot file                                   1.99s  
  âœ“ command handles empty symbols list                                   1.92s  
  âœ“ command with multiple symbols                                        2.04s  
  âœ“ command outputs consensus result                                     1.96s  
  âœ“ command with valid snapshot dry run                                  1.96s  
  âœ“ command with symbols option override                                 2.02s  
  âœ“ command includes trading config                                      1.96s  
  âœ“ command with invalid json snapshot                                   2.20s  
  âœ“ command requires snapshot file                                       2.10s  

   PASS  Tests\Feature\TradingWorkflowIntegrationTest
  âœ“ position sizing respects im caps                                     2.78s  
  âœ“ none veto blocks high confidence none                                2.66s  
  âœ“ funding guard blocks high funding near window                        2.58s  
  âœ“ full trading workflow long position                                  2.44s  
  âœ“ consensus deviation veto blocks trade                                2.31s  
  âœ“ correlation guard blocks correlated positions                        2.09s  
  âœ“ risk guard blocks unsafe leverage                                    2.00s  

   PASS  Tests\Feature\E2E\SpreadWideIocTwapTest
  âœ“ wide spread triggers ioc partial fill then twap                      0.14s  

   PASS  Tests\Feature\AppKeyTest
  âœ“ app key is set                                                       0.10s  

   PASS  Tests\Feature\FundingGuardRiskGateTest
  âœ“ funding rate block when above threshold                              0.11s  
  âœ“ funding rate allow when below threshold                              0.10s  

   PASS  Tests\Feature\ManagePositionsCommandTest
  âœ“ command ignores closed positions                                     2.11s  
  âœ“ command with valid snapshot no open positions                        2.02s  
  âœ“ command with invalid snapshot file                                   1.96s  
  âœ“ command handles position manager errors                              1.90s  
  âœ“ command handles large number of positions                            2.01s  
  âœ“ command with empty snapshot                                          2.04s  
  âœ“ command requires snapshot file                                       1.89s  
  âœ“ command outputs json format                                          1.99s  
  âœ“ command with invalid json snapshot                                   6.09s  
  âœ“ command with valid snapshot and open positions                       7.44s  

   WARN  Tests\Feature\E2E\HmacSecurityTest
  âœ“ invalid hmac signature returns 401 with event log                    0.23s  
  âœ“ expired timestamp returns 401                                        0.11s  
  - valid hmac signature returns 200 original â†’ HMAC signature calculatâ€¦ 0.10s  
  - valid hmac signature returns 200 â†’ HMAC signature calculation complâ€¦ 0.10s  

   PASS  Tests\Feature\TradeManagerTest
  âœ“ open with twap                                                       0.14s  
  âœ“ twap price calculation                                               0.10s  
  âœ“ twap with different chunks                                           0.15s  
  âœ“ postonly falls back to market ioc and sets tpsl                      0.13s  

   PASS  Tests\Feature\BybitClientTest
  âœ“ create order signs and sends                                         0.11s  

   PASS  Tests\Feature\RiskGuardTest
  âœ“ ok to open returns correct details for successful check              0.11s  
  âœ“ ok to open rejects invalid parameters                                0.09s  
  âœ“ ok to open rejects if sl too close to liquidation                    0.09s  

   WARN  Tests\Feature\InstrumentInfoServiceTest
  - parses filters â†’ InstrumentInfoService HTTP mock issues

   PASS  Tests\Feature\Notifier\AlertDeduplicationTest
  âœ“ auto generated dedup keys work correctly                             0.17s  
  âœ“ dedup stats return correct information                               0.16s  
  âœ“ restart scenario behavior documented                                 0.22s  
  âœ“ alert deduplication expires after ttl                                0.18s  
  âœ“ three identical alerts result in one dispatch two deduplicated       0.17s  
  âœ“ different dedup keys are not deduplicated                            0.16s  
  âœ“ dedup key normalization works                                        0.16s  

   WARN  Tests\Feature\E2E\StablecoinDepegTest
  - usdt depeg below 98 cents blocks trading â†’ HTTP mock not interceptiâ€¦ 0.13s  
  - usdc depeg above 102 cents blocks trading â†’ HTTP mock not interceptâ€¦ 0.09s  

   FAIL  Tests\Feature\LoadTestingTest
  âœ“ concurrent api requests                                              7.25s  
  âœ“ resource cleanup under load                                          9.87s  
  âœ“ system stability under prolonged load                               41.22s  
  âœ“ memory usage under load                                             12.02s  
  âœ“ concurrent trade creation                                           11.72s  
  âœ“ concurrent position management                                      11.91s  
  âœ“ high frequency ai consensus                                         11.51s  
  âœ“ cache performance under load                                        12.00s  
  âœ“ stress test risk management                                         11.52s  
  âœ“ failover performance under load                                     11.22s  
  â¨¯ database performance under load                                     42.47s  
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\LoadTestingTest > database performance under load      
  Failed asserting that 30.674203872680664 is less than 10.0.

  at tests/Feature/LoadTestingTest.php:162
    158â–•         // Verify data integrity
    159â–•         $this->assertCount($largeDataset, $openPositions);
    160â–• 
    161â–•         // Performance should be reasonable for test environment
  âžœ 162â–•         $this->assertLessThan(10.0, $createTime); // Create 1000 records in < 10 seconds (realistic for test env)
    163â–•         $this->assertLessThan(2.0, $queryTime); // Query in < 2.0 seconds (realistic for test env)
    164â–•     }
    165â–• 
    166â–•     public function test_cache_performance_under_load()

  1   tests/Feature/LoadTestingTest.php:162


  Tests:    1 failed, 13 skipped, 78 passed, [2m1247 pending[22m (1535 assertions)
  Duration: 261.82s
  Random Order Seed: 1756302862

Time: 04:21.027, Memory: 90.50 MB

Alert Deduplication (Tests\Feature\Notifier\AlertDeduplication)
 âœ” Three identical alerts result in one dispatch two deduplicated
 âœ” Alert deduplication expires after ttl
 âœ” Different dedup keys are not deduplicated
 âœ” Auto generated dedup keys work correctly
 âœ” Dedup key normalization works
 âœ” Dedup stats return correct information
 âœ” Restart scenario behavior documented

App Key (Tests\Feature\AppKey)
 âœ” App key is set

Bybit Client (Tests\Feature\BybitClient)
 âœ” Create order signs and sends

Ci Tools (Tests\Feature\CiTools)
 âœ” Structured logging service
 âœ” Ai logging
 âœ” Risk logging
 âœ” Performance logging
 âœ” Business event logging
 âœ” Json log channel exists
 âœ” Trading log channel exists
 âœ” Ai log channel exists
 âœ” Risk log channel exists
 âœ” Lab log channel exists

Correlation Guard Risk Gate (Tests\Feature\CorrelationGuardRiskGate)
 âœ” Correlation block when above threshold
 âœ” Correlation allow when no open positions

Funding Guard (Tests\Feature\FundingGuard)
 âœ” Blocks inside window with high bps
 âœ” Allows outside window or low bps

Funding Guard Risk Gate (Tests\Feature\FundingGuardRiskGate)
 âœ” Funding rate block when above threshold
 âœ” Funding rate allow when below threshold

Hmac Security (Tests\Feature\E2E\HmacSecurity)
 âœ” Invalid hmac signature returns 401 with event log
 âœ” Expired timestamp returns 401
 â†© Valid hmac signature returns 200
 â†© Valid hmac signature returns 200 original

Load Testing (Tests\Feature\LoadTesting)
 âœ” Concurrent trade creation
 âœ” High frequency ai consensus
 âœ” Concurrent position management
 âœ˜ Database performance under load
   â”‚
   â”‚ Failed asserting that 30.674203872680664 is less than 10.0.
   â”‚
   â”‚ /home/emir/Desktop/sentinentx/tests/Feature/LoadTestingTest.php:162
   â”‚
 âœ” Cache performance under load
 âœ” Memory usage under load
 âœ” Concurrent api requests
 âœ” Stress test risk management
 âœ” System stability under prolonged load
 âœ” Failover performance under load
 âœ” Resource cleanup under load

Manage Positions Command (Tests\Feature\ManagePositionsCommand)
 âœ” Command requires snapshot file
 âœ” Command with invalid snapshot file
 âœ” Command with invalid json snapshot
 âœ” Command with valid snapshot no open positions
 âœ” Command with valid snapshot and open positions
 âœ” Command handles position manager errors
 âœ” Command outputs json format
 âœ” Command ignores closed positions
 âœ” Command handles large number of positions
 âœ” Command with empty snapshot

Open Now Command (Tests\Feature\OpenNowCommand)
 âœ” Command requires snapshot file
 âœ” Command with invalid snapshot file
 âœ” Command with invalid json snapshot
 âœ” Command with missing required fields
 âœ” Command with valid snapshot dry run
 âœ” Command with multiple symbols
 âœ” Command with symbols option override
 âœ” Command includes trading config
 âœ” Command outputs consensus result
 âœ” Command handles empty symbols list
 âœ” Command handles symbols with spaces

Performance Gate Self Brake (Tests\Feature\E2E\PerformanceGateSelfBrake)
 âœ” Profit factor below threshold triggers self brake
 âœ” Performance above threshold allows trading

Risk Guard (Tests\Feature\RiskGuard)
 âœ” Ok to open rejects if sl too close to liquidation
 âœ” Ok to open rejects invalid parameters
 âœ” Ok to open returns correct details for successful check

Spread Wide Ioc Twap (Tests\Feature\E2E\SpreadWideIocTwap)
 âœ” Wide spread triggers ioc partial fill then twap

Stablecoin Depeg (Tests\Feature\E2E\StablecoinDepeg)
 â†© Usdt depeg below 98 cents blocks trading
 â†© Usdc depeg above 102 cents blocks trading

Trade Closer (Tests\Feature\TradeCloser)
 âœ” Close market reduce only

Trade Manager (Tests\Feature\TradeManager)
 âœ” Postonly falls back to market ioc and sets tpsl
 âœ” Open with twap
 âœ” Twap price calculation
 âœ” Twap with different chunks

Trading Workflow Integration (Tests\Feature\TradingWorkflowIntegration)
 âœ” Full trading workflow long position
 âœ” Consensus deviation veto blocks trade
 âœ” None veto blocks high confidence none
 âœ” Risk guard blocks unsafe leverage
 âœ” Position sizing respects im caps
 âœ” Correlation guard blocks correlated positions
 âœ” Funding guard blocks high funding near window

Websocket Gap Backfill (Tests\Feature\E2E\WebsocketGapBackfill)
 âœ” Websocket gap 30 seconds triggers rest backfill
 âœ” Duplicate oco attach prevention during backfill

FAILURES!
Tests: 92, Assertions: 1535, Failures: 1, PHPUnit Deprecations: 11, Skipped: 13.

Generating code coverage report in Clover XML format ... done [00:00.345]

Generating code coverage report in HTML format ... done [00:02.039]
