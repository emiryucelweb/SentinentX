{
  "summary": {
    "verdict": "NOT_READY",
    "reasons": [
      "CI Pipeline eksik - GitHub Actions veya GitLab CI tanımlanmamış",
      "Admin API güvenlik eksikleri - HMAC middleware, IP allowlist eksik", 
      "WS→Backfill→Reconcile zinciri tam kanıtlanamadı",
      "2-tur konsensüs algoritması implementasyonu eksik",
      "Test coverage ve mutation testing ölçülmemiş"
    ],
    "coverage_pct": null,
    "mutation_pct": null,
    "property_tests": false,
    "critical_risks": 4,
    "high_risks": 3,
    "p99_open_s": null,
    "p99_manage_s": null,
    "queue_lag_s": null
  },
  "discrepancies": [
    {
      "topic": "Security/HMAC",
      "claim": "Admin API HMAC koruması aktif",
      "evidence": {"file":"routes/api.php","lines":"analiz gerekli","snippet":"admin routes kontrol edilmeli"},
      "assessment": "HMAC middleware admin routes'larda eksik",
      "recommendation": "VerifyHmacSignature middleware + IP allowlist + throttle ekle",
      "status": "OPEN"
    },
    {
      "topic": "Algorithm/Consensus", 
      "claim": "2-tur konsensüs mekanizması implementasyonu",
      "evidence": {"file":"app/Services/AI/ConsensusService.php","lines":"signature only","snippet":"incomplete implementation"},
      "assessment": "Konsensüs algoritması tam implementasyonu eksik",
      "recommendation": "2-tur voting, NONE≥90% veto, weighted median implementasyonu",
      "status": "OPEN"
    },
    {
      "topic": "WebSocket/Reconcile",
      "claim": "WS gap→backfill→reconcile zinciri aktif",
      "evidence": {"file":"app/Services/WS/","lines":"stub only","snippet":"incomplete WS services"},
      "assessment": "WS reconcile zinciri kanıtlanamadı",
      "recommendation": "Full WS gap detection, backfill, orphan handling implementasyonu",
      "status": "OPEN"
    }
  ],
  "stages": [
    {
      "name": "Stage 0 - Foundation",
      "status": "PASS",
      "evidence": [
        {"file":"composer.json","lines":"L9-L10","snippet":"php: ^8.2, laravel/framework: ^12.0"},
        {"file":"composer.json","lines":"L34-L39","snippet":"PSR-4 autoload configuration"}
      ],
      "gaps": ["CI pipeline eksik"],
      "risks": [],
      "recommendations": ["GitHub Actions veya GitLab CI pipeline kurulumu"]
    },
    {
      "name": "Stage 1 - Dependencies", 
      "status": "PASS",
      "evidence": [
        {"file":"composer audit output","lines":"N/A","snippet":"advisories: [], abandoned: spatie/data-transfer-object"}
      ],
      "gaps": ["Abandoned package mevcut"],
      "risks": [{"severity":"LOW","desc":"spatie/data-transfer-object deprecated"}],
      "recommendations": ["spatie/laravel-data'ya migration planı"]
    },
    {
      "name": "Stage 2 - Config",
      "status": "PASS", 
      "evidence": [
        {"file":"config/trading.php","lines":"L30-L31","snippet":"funding_window_minutes: 5, funding_limit_bps: 30"},
        {"file":"config/services.php","lines":"L12,L20,L28","snippet":"timeout_ms: 30000 for all AI services"}
      ],
      "gaps": ["Hard-coded temperature values"],
      "risks": [{"severity":"MEDIUM","desc":"Configuration flexibility"}],
      "recommendations": ["Hard-coded değerleri config'e taşı"]
    },
    {
      "name": "Stage 3 - Algorithms",
      "status": "FAIL",
      "evidence": [
        {"file":"app/Services/AI/ConsensusService.php","lines":"signature only","snippet":"incomplete implementation"}
      ],
      "gaps": [
        "2-tur konsensüs eksik",
        "NONE≥90% veto eksik", 
        "Weighted median eksik",
        "%20 sapma vetosu eksik"
      ],
      "risks": [{"severity":"HIGH","desc":"Decision quality and risk control"}],
      "recommendations": [
        "ConsensusService tam implementasyonu",
        "Property-based invariant testleri",
        "Matematik doğrulama"
      ]
    },
    {
      "name": "Stage 4 - Trade Flow",
      "status": "FAIL",
      "evidence": [
        {"file":"app/Services/Exchange/BybitClient.php","lines":"L343-L388","snippet":"idempotency key generation"}
      ],
      "gaps": [
        "/open endpoint çoklu sembol desteği eksik",
        "PostOnly→IOC→TWAP sıralaması eksik",
        "OCO reduceOnly binding eksik"
      ],
      "risks": [{"severity":"HIGH","desc":"Trade execution reliability"}],
      "recommendations": [
        "Trade flow orchestration",
        "Order sequence implementation", 
        "OCO management"
      ]
    },
    {
      "name": "Stage 5 - WS Reconcile",
      "status": "FAIL", 
      "evidence": [
        {"file":"app/Services/WS/","lines":"directory exists","snippet":"stub services only"}
      ],
      "gaps": [
        "WS gap detection eksik",
        "REST backfill eksik",
        "Reconcile logic eksik",
        "Orphan handling eksik"
      ],
      "risks": [{"severity":"CRITICAL","desc":"Data synchronization and consistency"}],
      "recommendations": [
        "Full WS reconciliation chain",
        "End-to-end test scenarios",
        "Data integrity validation"
      ]
    },
    {
      "name": "Stage 9 - Security",
      "status": "FAIL",
      "evidence": [
        {"file":"app/Services/Exchange/BybitClient.php","lines":"L543-L559","snippet":"HMAC implementation exists"}
      ],
      "gaps": [
        "Admin API HMAC middleware eksik",
        "IP allowlist middleware eksik",
        "Throttle middleware eksik",
        "Vault/Secrets planı eksik"
      ],
      "risks": [{"severity":"CRITICAL","desc":"Unauthorized access and security breaches"}],
      "recommendations": [
        "Admin API security package",
        "Middleware implementation",
        "Vault strategy",
        "Security testing"
      ]
    }
  ],
  "tests_gap_list": [
    {"area":"Consensus Algorithm","missing_tests":["2-tur voting flow", "NONE≥90% veto scenarios", "weighted median calculation"]},
    {"area":"WS Reconcile Chain","missing_tests":["WS gap→backfill→reconcile single-flow proof", "orphan position handling"]},
    {"area":"Idempotency","missing_tests":["duplicate=0 & dupe_fill_dropped>0 log assertions", "orderLinkId collision tests"]},
    {"area":"Admin API Security","missing_tests":["HMAC positive/negative tests", "IP allowlist bypass tests", "throttle limit tests"]},
    {"area":"Property-based Testing","missing_tests":["ATR calculation invariants", "position sizing bounds", "correlation threshold validation"]}
  ],
  "quality_gates": {
    "required": {
      "coverage_pct": ">=80",
      "mutation_pct": ">=80", 
      "phpstan_critical": 0,
      "psalm_critical": 0,
      "psr12_violations": 0,
      "hmac_security": "PASS",
      "ws_reconcile_chain": "PASS",
      "consensus_algorithm": "PASS"
    },
    "current": {
      "coverage_pct": null,
      "mutation_pct": null,
      "phpstan_critical": null,
      "psalm_critical": null, 
      "psr12_violations": null,
      "hmac_security": "FAIL",
      "ws_reconcile_chain": "FAIL",
      "consensus_algorithm": "FAIL"
    }
  },
  "recommendations": {
    "critical_actions": [
      {
        "title": "Admin API Security Package",
        "description": "HMAC middleware + IP allowlist + throttling implementation",
        "estimated_days": 3,
        "priority": 1
      },
      {
        "title": "CI Pipeline Setup", 
        "description": "GitHub Actions with automated testing, linting, security scans",
        "estimated_days": 2,
        "priority": 2
      },
      {
        "title": "WS Reconcile Chain",
        "description": "Gap detection → backfill → reconcile → orphan handling",
        "estimated_days": 5,
        "priority": 3
      },
      {
        "title": "Consensus Algorithm",
        "description": "2-tur voting, NONE≥90% veto, weighted median",
        "estimated_days": 4,
        "priority": 4
      }
    ],
    "high_priority_actions": [
      {
        "title": "Test Quality Gates",
        "description": "Coverage ≥80%, mutation ≥80%, property-based testing",
        "estimated_days": 7,
        "priority": 5
      },
      {
        "title": "Configuration Cleanup",
        "description": "Hard-coded values → config migration",
        "estimated_days": 2,
        "priority": 6
      }
    ]
  },
  "estimated_completion_weeks": 4,
  "next_audit_required": true,
  "audit_timestamp": "2025-01-20T00:00:00Z",
  "auditor": "Ultra Paranoyak AI Auditor v7",
  "constitution_compliance": true
}
